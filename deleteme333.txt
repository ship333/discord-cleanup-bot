import discord
import asyncio

TOKEN = "MTQ0MTUzNTY0MDg1OTgzNjYwOA.GOfbT0.WlOeQiUPv5wxAGDyRUfD2PlsFhn7v2b2dZo1B8"
TARGET_USER_ID = 1021871981584466002 # Replace with the user ID to clean up
TARGET_CHANNEL_IDS = [1441535358469931060, 1441543955232850065] # Channels to crawl

# Delay between deletions to avoid rate-limits
DELETE_DELAY = 1.5  # seconds (can go slower if needed)

class CleanupBot(discord.Client):
    async def on_ready(self):
        print(f"Logged in as {self.user}")
        await self.cleanup_messages()

    async def cleanup_messages(self):
        for channel_id in TARGET_CHANNEL_IDS:
            channel = self.get_channel(channel_id)

            if channel is None:
                print(f"Channel {channel_id} not found!")
                continue

            print(f"\nChecking channel: {channel.name} ({channel.id})")

            async for msg in channel.history(limit=None, oldest_first=True):
                if msg.author.id == TARGET_USER_ID:
                    try:
                        await msg.delete()
                        print(f"Deleted: {msg.content[:50]}")
                        await asyncio.sleep(DELETE_DELAY)
                    except Exception as e:
                        print(f"Failed to delete message: {e}")

        print("\nâœ” Cleanup complete. Exiting.")
        await self.close()

intents = discord.Intents.default()
intents.message_content = True  # Required for reading messages
intents.guilds = True
intents.messages = True
client = CleanupBot(intents=intents)
client.run(TOKEN)
